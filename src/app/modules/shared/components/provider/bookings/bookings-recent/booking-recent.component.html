<section class="w-full">

  <!-- Filters / Header -->
  <ng-container *ngIf="showFilters">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4">
      <!-- Heading -->
      <h2 class="text-lg sm:text-xl font-semibold text-gray-800 tracking-tight">
        Recent Bookings
      </h2>

      <!-- Search Input -->
      <div class="relative w-full sm:w-64">
        <input type="text" placeholder="Search by name or ID..." [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchTriggered()" class="w-full px-3 py-2 text-sm sm:text-base text-gray-700 bg-white border border-gray-300 rounded-lg 
                 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all placeholder-gray-400" />
        <i class="fas fa-search absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
      </div>
    </div>
  </ng-container>

  <!-- Bookings Table Container -->
  <div class="bg-white rounded-md shadow-sm border border-gray-100 overflow-hidden">
    <ng-container *ngIf="bookingResponseData$ | async as bookingResponseData">
      <div class="overflow-x-auto">
        <table class="min-w-full table-auto text-sm sm:text-base text-left text-gray-700">
          <!-- Table Header -->
          <thead class="bg-gray-100 text-xs sm:text-sm uppercase text-gray-600 tracking-wider">
            <tr>
              <th class="px-4 py-3 whitespace-nowrap">Booking ID</th>
              <th class="px-4 py-3 whitespace-nowrap">Customer</th>
              <th class="px-4 py-3 whitespace-nowrap">Date & Time</th>
              <th class="px-4 py-3 whitespace-nowrap">Status</th>
              <th class="px-4 py-3 whitespace-nowrap">Payment</th>
              <th class="px-4 py-3 whitespace-nowrap">Cancel</th>
              <ng-container *ngIf="actionable">
                <th class="px-4 py-3 text-center">Actions</th>
              </ng-container>
            </tr>
          </thead>

          <!-- Table Body -->
          <tbody class="divide-y divide-gray-200 bg-white">
            <ng-container *ngFor="let booking of bookingResponseData.bookingData">
              <tr class="hover:bg-gray-50 transition-colors duration-150 ease-in-out">
                <!-- Booking ID -->
                <td class="px-4 py-3 font-medium text-gray-900 truncate max-w-[140px]">
                  #{{ booking.bookingId.toUpperCase() | slice: 0:10 }}
                </td>

                <!-- Customer Info -->
                <td class="px-4 py-3">
                  <div class="flex items-center gap-3">
                    <img [src]="booking.customer.avatar" alt="Customer"
                      class="h-8 w-8 sm:h-9 sm:w-9 rounded-full object-cover border border-gray-200" loading="lazy"
                      (error)="onImageError($event)" />
                    <div class="min-w-0">
                      <p class="font-medium truncate">
                        {{ booking.customer.name }}
                      </p>
                      <p class="text-xs text-gray-500 truncate">
                        {{ booking.customer.email }}
                      </p>
                    </div>
                  </div>
                </td>

                <!-- Date & Time -->
                <td class="px-4 py-3 whitespace-nowrap">
                  <p class="text-gray-800 font-medium">
                    {{ getDate(booking.expectedArrivalTime) }}
                  </p>
                  <p class="text-gray-500 text-xs sm:text-sm">
                    {{ getTime(booking.expectedArrivalTime) }}
                  </p>
                </td>

                <!-- Booking Status -->
                <td class="px-4 py-3">
                  <span class="inline-flex items-center px-2 py-1 text-xs font-semibold rounded-full" [ngClass]="{
                      'bg-green-100 text-green-700': booking.bookingStatus === 'completed',
                      'bg-yellow-100 text-yellow-700': booking.bookingStatus === 'pending',
                      'bg-red-100 text-red-700': booking.bookingStatus === 'cancelled'
                    }">
                    {{ booking.bookingStatus }}
                  </span>
                </td>

                <!-- Payment Status -->
                <td class="px-4 py-3">
                  <span class="inline-flex items-center px-2 py-1 text-xs font-semibold rounded-full" [ngClass]="{
                      'bg-blue-100 text-blue-700': booking.paymentStatus === 'paid',
                      'bg-gray-100 text-gray-600': booking.paymentStatus !== 'paid'
                    }">
                    {{ booking.paymentStatus }}
                  </span>
                </td>

                <!-- Cancel Request -->
                <td class="px-4 py-3">
                  <ng-container [ngSwitch]="booking.cancelStatus">
                    <span *ngSwitchCase="'in_progress'"
                      class="inline-block px-2 py-1 text-xs font-semibold rounded-full bg-indigo-100 text-indigo-700">
                      Requested
                    </span>
                    <span *ngSwitchCase="'cancelled'"
                      class="inline-block px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-700">
                      Cancelled
                    </span>
                    <span *ngSwitchDefault class="inline-block text-xs font-medium text-gray-400">---</span>
                  </ng-container>
                </td>

                <!-- Actions -->
                <ng-container *ngIf="actionable">
                  <td class="px-4 py-3 text-center">
                    <div class="flex justify-center items-center gap-3 text-base sm:text-lg">
                      <a [routerLink]="[booking.bookingId]" class="text-blue-600 hover:text-blue-800"
                        aria-label="View details">
                        <i class="fas fa-eye"></i>
                      </a>

                      <button (click)="goToChat(booking.customer.id)" class="text-green-600 hover:text-green-800"
                        aria-label="Message customer">
                        <i class="fas fa-comment"></i>
                      </button>

                      <button class="text-gray-600 hover:text-gray-800" aria-label="More options">
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </td>
                </ng-container>
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <ng-container *ngIf="actionable">
        <div class="border-t border-gray-100 bg-gray-50">
          <app-provider-pagination [pagination]="bookingResponseData.paginationData"
            (pageChange)="loadBookings($event)"></app-provider-pagination>
        </div>
      </ng-container>
    </ng-container>
  </div>
</section>