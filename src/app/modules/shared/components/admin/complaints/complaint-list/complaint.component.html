<div class="max-w-6xl pb-8">
    <section class="bg-gray-50">
        <h1 class="text-lg sm:text-xl lg:text-2xl font-semibold text-gray-800">
            Overview
        </h1>
        <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6 p-6">
            <app-admin-overview-card *ngFor="let stat of overviewComplaints" [title]="stat.title" [value]="stat.value"
                [icon]="stat.icon" [iconBg]="stat.iconBg" [subtext]="stat.subtext"></app-admin-overview-card>
        </div>
    </section>

    <section class="flex flex-col gap-4 mb-8">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div class="pt-4">
                <h3 class="text-lg md:text-xl font-semibold text-gray-800">
                    All Complaint
                </h3>
                <p class="text-sm text-gray-500 mt-0.5">
                    Browse, filter, and manage all submitted complaints.
                </p>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 md:gap-4">
                <div class="relative">
                    <input type="text" placeholder="Search complaints..." id="search" [(ngModel)]="filters.search"
                        (ngModelChange)="searchReport()"
                        class="w-full border border-gray-300 rounded-md pl-8 pr-3 py-1.5 text-sm outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    <i class="fas fa-search absolute left-2.5 top-1/2 -translate-y-1/2 text-gray-400 text-xs"></i>
                </div>

                <div class="relative">
                    <select id="status" [(ngModel)]="filters.status" (ngModelChange)="toggleSelect()"
                        class="w-full border border-gray-300 rounded-md px-3 py-1.5 text-sm outline-none appearance-none">
                        <option value="">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="resolved">Resolved</option>
                        <option value="rejected">Rejected</option> 
                        <option value="flagged">Flagged</option>
                    </select>
                    <i
                        class="fas fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs pointer-events-none"></i>
                </div>

                <div class="relative">
                    <select id="type" [(ngModel)]="filters.type" (ngModelChange)="toggleSelect()"
                        class="w-full border border-gray-300 rounded-md px-3 py-1.5 text-sm outline-none appearance-none">
                        <option value="">All Types</option>
                        <option value="customer">Customer</option>
                        <option value="provider">Provider</option>
                    </select>
                    <i
                        class="fas fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs pointer-events-none"></i>
                </div>
            </div>
        </div>
    </section>

    <div class="overflow-x-auto bg-white rounded-xl shadow border">
        <table class="min-w-full text-sm text-left text-gray-700">
            <thead class="bg-gray-100 border-b text-gray-600 uppercase text-xs">
                <tr>
                    <th class="p-4">ReportID</th>
                    <th class="p-4">Reported By</th>
                    <th class="p-4">Target</th>
                    <th class="p-4">Type</th>
                    <th class="p-4">Reason</th>
                    <th class="p-4">Status</th>
                    <th class="p-4">Date</th>
                    <th class="p-4 text-right">Actions</th>
                </tr>
            </thead>
            <tbody>
                <ng-container *ngIf="reports.length > 0; else noData">
                    <tr *ngFor="let report of reports" class="border-b hover:bg-gray-50 transition ">
                        <td class="p-4 font-mono text-xs">{{report.id | slice:0:10 | uppercase}}</td>
                        <td class="p-4">{{report.reportedId | slice:0:10 | uppercase}}</td>
                        <td class="p-4">{{report.targetId | slice:0:10 | uppercase}}</td>
                        <td class="p-4 capitalize">{{report.type}}</td>
                        <td class="p-4 truncate max-w-[180px]" title="{{report.reason}}">{{report.reason}}</td>
                        <td class="p-4">
                            <span [ngClass]="getReportStatusClasses(report.status)"
                                class="px-2 py-1 text-xs font-semibold rounded-full capitalize">{{report.status}}</span>
                        </td>
                        <td class="px-4 py-3">{{report.createdAt | date:'medium'}}</td>
                        <td class="p-3 flex justify-end gap-2">
                            <app-button buttonClass="text-blue-600 hover:text-blue-700 text-md" icon="eye"
                                (clicked)="toggleReportViewModal(report.id)"></app-button>
                            <app-button buttonClass="text-green-600 hover:text-green-700 text-md" icon="check-circle"
                                [disabled]="isActionDisabled(report.status)"
                                (clicked)="resolveReport(report.id)"></app-button>
                        </td>
                    </tr>
                </ng-container>

                <ng-template #noData>
                    <tr>
                        <td colspan="8" class="text-center">
                            <div
                                class="col-span-full flex flex-col items-center justify-center min-h-[300px] text-gray-500 bg-gray-50 rounded-lg border border-dashed border-gray-300 p-6">
                                <svg class="w-12 h-12 mb-4 text-gray-400" fill="none" stroke="currentColor"
                                    stroke-width="1.5" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M9.75 9.75h4.5m-4.5 4.5h4.5M4.5 6.75h15M6.75 6.75v10.5A2.25 2.25 0 009 19.5h6a2.25 2.25 0 002.25-2.25V6.75" />
                                </svg>
                                <p class="text-lg font-medium">No data found</p>
                                <p class="text-sm text-gray-400 mt-1">Try adjusting your filters or check back
                                    later.
                                </p>
                                <button
                                    class="mt-3 px-3 py-1 text-xs text-indigo-600 border border-indigo-200 rounded hover:bg-indigo-50">
                                    Clear Filters
                                </button>
                            </div>
                        </td>
                    </tr>
                </ng-template>
            </tbody>
        </table>
        <app-admin-pagination [pagination]="pagination" (pageChange)="changePage($event)"></app-admin-pagination>
    </div>
</div>

<div *ngIf="isReportViewModalOpen() && selectedReportId"
    class="fixed inset-0 z-50 flex items-center justify-center bg-black/50">
    <app-admin-complaint-view [reportId]="selectedReportId" (statusEvent)="statusChanged($event)"
        (closeModalEvent)="toggleReportViewModal()"></app-admin-complaint-view>
</div>