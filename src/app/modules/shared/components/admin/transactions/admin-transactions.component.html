<div class="transactions-container">
    <div class="header-top">
        <div class="title-info">
            <h1>Transaction Management</h1>
            <p>Monitor platform revenue, payouts, and detailed fee breakdowns.</p>
        </div>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
        <app-admin-overview-card *ngFor="let stat of stats()" [icon]="stat.icon" [iconBg]="stat.iconBg"
            [title]="stat.title" [value]="stat.value" [subtext]="stat.subtext">
        </app-admin-overview-card>
    </div>

    <!-- Filters Bar -->
    <div class="filters-bar">
        <div class="search-box">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input [ngModel]="filters().search" (ngModelChange)="onSearch($event)" type="text"
                placeholder="Search by ID, email or reference..." />
        </div>

        <div class="filter-group">
            <select [ngModel]="filters().sort" (ngModelChange)="onSort($event)" class="filter-select">
                <option value="newest">Newest First</option>
                <option value="oldest">Oldest First</option>
                <option value="high">Amount: High to Low</option>
                <option value="low">Amount: Low to High</option>
            </select>

            <select [ngModel]="filters().type" (ngModelChange)="onTypeChange($event)" class="filter-select">
                <option value="all">All Types</option>
                <option value="booking">Booking Related</option>
                <option value="subscription">Subscriptions</option>
                <option value="refund">Refunds</option>
            </select>

            <select [ngModel]="filters().method" (ngModelChange)="onMethodChange($event)" class="filter-select">
                <option value="all">All Directions</option>
                <option value="credit">Credits (Income)</option>
                <option value="debit">Debits (Payouts)</option>
            </select>

            <select [ngModel]="filters().date" (ngModelChange)="onDateChange($event)" class="filter-select">
                <option value="all">All Time</option>
                <option value="last_six_months">Last 6 Months</option>
                <option value="last_year">Last Year</option>
            </select>
        </div>
    </div>

    <div class="transaction-table-card">
        <table class="modern-table">
            <thead>
                <tr>
                    <th>SL No</th>
                    <th>Date & Time</th>
                    <th>Counterparty</th>
                    <th>Type</th>
                    <th>Method</th>
                    <th>Amount</th>
                    <th>Reference</th>
                    <th>Source</th>
                </tr>
            </thead>

            <tbody>
                <tr *ngFor="let tx of transactions(); let i = index" class="hover:bg-gray-50/50 transition-colors">
                    <td class="sl-no">
                        {{ (pagination().page - 1) * pagination().limit + i + 1 }}
                    </td>
                    <td class="date-cell">
                        <div class="date">{{ tx.dateTime | date:'MMM d, y' }}</div>
                        <div class="time">{{ tx.dateTime | date:'h:mm a' }}</div>
                    </td>

                    <td class="counterparty-cell">
                        <ng-container *ngIf="tx.counterparty.email !== 'Internal'; else internal">
                            <div class="user-info">
                                <div class="details">
                                    <span class="role-badge" [ngClass]="tx.counterparty.role">
                                        {{ tx.counterparty.role }}
                                    </span>
                                    <span class="email">{{ tx.counterparty.email }}</span>
                                </div>
                            </div>
                        </ng-container>
                        <ng-template #internal>
                            <span class="internal-label">
                                <i class="fa-solid fa-building-shield"></i> System Internal
                            </span>
                        </ng-template>
                    </td>

                    <td class="type-cell">
                        <span class="type-text">{{ displayType(tx.type) }}</span>
                    </td>

                    <td class="method-cell">
                        <span class="direction-badge" [ngClass]="tx.direction">
                            <i class="fa-solid"
                                [ngClass]="tx.direction === 'credit' ? 'fa-arrow-down' : 'fa-arrow-up'"></i>
                            {{ tx.direction === 'credit' ? 'Credit' : 'Debit' }}
                        </span>
                    </td>

                    <td class="amount-cell">
                        <span class="amount" [ngClass]="tx.direction">
                            {{ tx.direction === 'credit' ? '+' : '-' }}{{ formatINR(tx.amount) }}
                        </span>
                    </td>

                    <td class="reference-cell">
                        <div class="ref-box" (click)="copyToClipboard(tx.referenceId)" [title]="'Copy Reference ID'">
                            <span class="ref-type">{{ tx.referenceType }}</span>
                            <span class="ref-id">#{{ tx.referenceId.slice(10) }}</span>
                            <i class="fa-solid fa-copy copy-icon"></i>
                        </div>
                    </td>

                    <td class="source-cell">
                        <span class="source-badge">
                            {{ tx.source }}
                        </span>
                    </td>
                </tr>

                <tr *ngIf="transactions().length === 0">
                    <td colspan="7" class="empty-state">
                        <i class="fa-solid fa-receipt"></i>
                        <p>No transactions found matching your filters.</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <div>
        <app-admin-pagination [pagination]="pagination()" (pageChange)="pageChange($event)"></app-admin-pagination>
    </div>
</div>