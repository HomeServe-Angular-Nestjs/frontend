<div class="flex flex-col h-full bg-white border-r">

    <!-- ================= SEARCH ================= -->
    <div class="px-3 py-2 border-b">
        <input type="text" placeholder="Search chats" class="w-full px-3 py-1.5 text-sm border rounded-full
             focus:outline-none focus:ring focus:border-blue-400" />
    </div>

    <!-- ================= CHAT LIST ================= -->
    <ng-container *ngIf="(chats$ | async) as chats; else loadingChats">
        <div *ngIf="chats.length > 0; else noChats" class="overflow-y-auto flex-1">

            <ul>
                <li *ngFor="let chat of chats" (click)="viewMessages(chat.id)" class="px-3 py-2.5 flex items-center gap-3 cursor-pointer
                 border-b hover:bg-gray-100 transition">

                    <!-- Avatar -->
                    <img [src]="imageHandler(chat.receiver.avatar)" alt="avatar" (error)="onImgError($event)"
                        class="w-10 h-10 rounded-full object-cover" />

                    <!-- Name + Last Message -->
                    <div class="flex-1 min-w-0">
                        <p class="font-medium text-sm text-gray-800 truncate">
                            {{ chat.receiver.name }}
                        </p>
                        <p class="text-xs text-gray-500 truncate">
                            {{ chat.lastMessage || 'No messages yet' }}
                        </p>
                    </div>

                    <!-- Time + Unread -->
                    <div class="flex flex-col items-end gap-1 shrink-0">
                        <p *ngIf="chat.lastSeenAt as date" class="text-[11px] text-gray-400 whitespace-nowrap">
                            {{ date | date:'d/M/yyyy' }}
                        </p>

                        <span *ngIf="chat.unreadMessages > 0" class="min-w-[18px] h-[18px] px-1.5
                     text-[11px] flex items-center justify-center
                     text-white bg-blue-600 rounded-full">
                            {{ chat.unreadMessages }}
                        </span>
                    </div>

                </li>
            </ul>

        </div>
    </ng-container>

    <!-- ================= LOADING ================= -->
    <ng-template #loadingChats>
        <div class="flex flex-col items-center justify-center h-full text-gray-400">
            <svg class="animate-spin h-6 w-6 mb-3 text-blue-400" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
            </svg>

            <p class="text-sm font-medium">Loading chatsâ€¦</p>
        </div>
    </ng-template>

    <!-- ================= EMPTY ================= -->
    <ng-template #noChats>
        <div class="flex flex-col items-center justify-center h-full text-gray-400">
            <i class="fas fa-comment-dots text-4xl mb-3"></i>
            <p class="text-sm font-medium">No chats yet</p>
            <p class="text-xs text-gray-500 mt-1 text-center px-4">
                Start a new conversation to see it here.
            </p>
        </div>
    </ng-template>

</div>